/*
 imguploader.js v1.0.10
 https://github.com/brunomp/imguploader/
 Date: 2017-06-18T20:32:05.335Z
 Date: 2018-09-04T13:49:05.335Z
*/
(function(k,g,v){k.URL=k.URL||k.webkitURL;k.ImgUploader=function(r){function t(a){if(!(0<a.xhr.readyState)){var d=g.createElement("canvas"),e=d.getContext("2d"),c=a.image.width,f=a.image.height;c>f?c>b.opts.reduceWidth&&(f*=b.opts.reduceWidth/c,c=b.opts.reduceWidth):f>b.opts.reduceHeight&&(c*=b.opts.reduceHeight/f,f=b.opts.reduceHeight);d.width=c;d.height=f;e.drawImage(a.image,0,0,c,f);d=d.toDataURL(a.file.type);b.opts.formData.set(b.opts.paramName,d);a.xhr.open("POST",b.opts.target,!0);h(b.opts.headers,
function(b,c){a.xhr.setRequestHeader(c,b)});a.xhr.onload=function(){4==a.xhr.readyState&&200<=a.xhr.status&&300>=a.xhr.status?(a.status="sucess",a.container.classList.add("uploadSucess")):(a.status="error",a.container.classList.add("uploadError"));q(a);p()};a.xhr.upload.addEventListener("progress",function(b){b.lengthComputable&&(a.progressBar.value=Math.round(b.loaded/b.total*100))},!1);a.xhr.send(b.opts.formData)}}function u(a){if(/^image\//.test(a.type)){var d={},e=g.createElement("div"),c=g.createElement("div"),
f=g.createElement("div"),h=g.createElement("progress"),n=g.createElement("div"),l=g.createElement("button");e.classList.add("queueItem");c.classList.add("thumb");f.classList.add("progress");h.max=100;n.classList.add("menu");l.innerText=b.opts.btnCancelText;l.classList.add("btnCancel");l.addEventListener("click",function(){var a=d;4!=a.xhr.readyState&&"canceled"!=a.status&&(a.status="canceled",a.container.classList.add("uploadCanceled"),a.xhr.abort(),a.progressBar.value=0,q(a),p())});f.appendChild(h);
n.appendChild(l);e.appendChild(c);e.appendChild(f);e.appendChild(n);var m=new Image;m.src=k.URL.createObjectURL(a);m.onload=function(){c.style="background-image: url('"+m.src+"');";p()};d={status:"queue",file:a,image:m,xhr:new XMLHttpRequest,container:e,progressBar:h,btnCancel:l};g.getElementById(b.opts.containerId).appendChild(e);b.queue.push(d)}}function p(){if(0<b.queue.length){if(0==b.done.length)b.opts.onQueueStart();b.queue[0].image.complete&&t(b.queue[0])}else b.opts.onQueueConclude(b.done),
b.done=[],b.inputFileElm.value=""}function q(a){a.btnCancel.disabled="disabled";b.done.push(a);b.queue.splice(b.queue.indexOf(a),1);b.opts.onItemConclude(a)}function h(a,b,e){if(a){var c;if("undefined"!==typeof a.length)for(c=0;c<a.length&&!1!==b.call(e,a[c],c);c++);else for(c in a)if(a.hasOwnProperty(c)&&!1===b.call(e,a[c],c))break}}var b=this;this.defaults={target:k.location.href,formData:new FormData,headers:{},paramName:"image",inputFileId:"image",reduceWidth:1E3,reduceHeight:1E3,containerId:"uploads",
btnCancelText:"CANCEL",onQueueConclude:function(){},onQueueStart:function(){},onItemConclude:function(){}};this.opts={};this.opts=function(a,b){h(arguments,function(b){b!==a&&h(b,function(b,d){a[d]=b})});return a}({},this.defaults,r||{});this.inputFileElm=g.getElementById(this.opts.inputFileId);this.inputFileElm.accept="image/*";this.queue=[];this.done=[];this.inputFileElm.addEventListener("change",function(){for(var a=this.files.length,b=0;b<a;b++)u(this.files[b])})}})(window,document);
