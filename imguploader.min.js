/*
 imguploader.js v1.0.0
 https://github.com/brunomp/imguploader/
 Date: 2017-06-18T20:32:05.335Z
*/
(function(h,g,v){h.URL=h.URL||h.webkitURL;h.ImgUploader=function(r){function t(a){if(!(0<a.xhr.readyState)){var d=g.createElement("canvas"),e=d.getContext("2d"),c=a.image.width,f=a.image.height;c>f?c>b.opts.reduceWidth&&(f*=b.opts.reduceWidth/c,c=b.opts.reduceWidth):f>b.opts.reducetHeight&&(c*=b.opts.reducetHeight/f,f=b.opts.reducetHeight);d.width=c;d.height=f;e.drawImage(a.image,0,0,c,f);d=d.toDataURL(a.file.type);b.opts.formData.append(b.opts.paramName,d);a.xhr.open("POST",b.opts.target,!0);a.xhr.onload=
function(){4==a.xhr.readyState&&200<=a.xhr.status&&300>=a.xhr.status?(a.status="sucess",a.container.classList.add("uploadSucess")):(a.status="error",a.container.classList.add("uploadError"));b.done.push(a);b.queue.splice(b.queue.indexOf(a),1);b.opts.onItemConclude(a);m()};a.xhr.upload.addEventListener("progress",function(b){b.lengthComputable&&(a.progressBar.value=Math.round(b.loaded/b.total*100))},!1);a.xhr.send(b.opts.formData)}}function u(a){if(/^image\//.test(a.type)){var d={},e=g.createElement("div"),
c=g.createElement("div"),f=g.createElement("div"),n=g.createElement("progress"),p=g.createElement("div"),k=g.createElement("button");e.classList.add("queueItem");c.classList.add("thumb");f.classList.add("progress");n.max=100;p.classList.add("menu");k.innerText=b.opts.btnCancelText;k.classList.add("btnCancel");k.addEventListener("click",function(){var a=d;4!=a.xhr.readyState&&"canceled"!=a.status&&(a.status="canceled",a.container.classList.add("uploadCanceled"),a.xhr.abort(),a.progressBar.value=0,
b.done.push(a),b.queue.splice(b.queue.indexOf(a),1),b.opts.onItemConclude(a),m())});f.appendChild(n);p.appendChild(k);e.appendChild(c);e.appendChild(f);e.appendChild(p);var l=new Image;l.src=h.URL.createObjectURL(a);l.onload=function(){c.style="background-image: url('"+l.src+"');";m()};d={status:"queue",file:a,image:l,xhr:new XMLHttpRequest,container:e,progressBar:n};g.getElementById(b.opts.containerId).appendChild(e);b.queue.push(d)}}function m(){0<b.queue.length?b.queue[0].image.complete&&t(b.queue[0]):
(b.opts.onQueueConclude(b.done),b.done=[])}function q(a,b,e){if(a){var c;if("undefined"!==typeof a.length)for(c=0;c<a.length&&!1!==b.call(e,a[c],c);c++);else for(c in a)if(a.hasOwnProperty(c)&&!1===b.call(e,a[c],c))break}}var b=this;this.defaults={target:h.location.href,formData:new FormData,paramName:"image",inputFileId:"image",reduceWidth:1E3,reducetHeight:1E3,containerId:"uploads",btnCancelText:"CANCEL",onQueueConclude:function(){},onItemConclude:function(){}};this.opts={};this.opts=function(a,
b){q(arguments,function(b){b!==a&&q(b,function(b,d){a[d]=b})});return a}({},this.defaults,r||{});this.inputFileElm=g.getElementById(this.opts.inputFileId);this.inputFileElm.accept="image/*";this.queue=[];this.done=[];this.inputFileElm.addEventListener("change",function(){for(var a=this.files.length,b=0;b<a;b++)u(this.files[b])})}})(window,document);
